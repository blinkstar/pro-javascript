### 23.3.1 Cookie

  HTTP Cookie, 通常直接叫做 cookie, 最初是在客户端用于存储会话信息的。该标准要求服务器对任意 HTTP 请求发送 Set-Cookie HTTP 头
作为响应的一部分，其中包含会话信息。例如，这种服务器响应的头可能如下：

    HTTP/1.1 200 OK
    Content-type: text/html
    Set-Cookie: name=value
    Other-header: other-header-value

  这个 HTTP 响应设置以 name 为名称、以 value 为值的一个 cookie, 名称和值在传送时都必须是 URL 编码的。浏览器会存储这样的会话信息，
并在这之后，通过为每个请求添加 Cookie HTTP 头将信息发送回服务器，如下所示：

    GET /index.html HTTP/1.1
    Cookie: name=value
    Other-header: other-header-value

  发送回服务器的额外信息可以用于唯一验证客户来自于发送的哪个请求。

#### 1 限制

  cookie 在性质上是绑定在特定的域名下的。当设定了一个 cookie 后，再给创建它的域名发送请求时，都会包含这个 cookie 。这个限制
确保了存储在 cookie 中的信息只能让批准的接受者访问，而无法被其他域访问。

  由于 cookie 是存在客户端计算机上的，还加入了一些限制确保 cookie 不会被恶意使用，同时不会占据太多磁盘空间。每个域的 cookie
总数是有限的，不过浏览器之间各有不同。如下所示。

 - IE6 以及更低版本限制每个域名最多 20 个 cookie 。
 - IE7 和之后版本每个域名最多 50 个。 IE7 最初是支持每个域名最大 20 个 cookie ，之后被微软的一个补丁所更新。
 - Firefox 限制每个域最多 50 个 cookie 。
 - Opera 限制每个域最多 30 个 cookie 。
 - Safari 和 Chrome 对于每个域的 cookie 数量限制没有硬性规定。

  当超过单个域名限制之后还要再设置 cookie ，浏览器就会清除以前设置的 cookie 。IE 和 Opera 会删除最近最少使用
过的 (LRU, Least Recently Used) cookie ，腾出空间给新设置的 cookie 。Firefox 看上去好像是随机决定要清除哪个 cookie ,
所以考虑 cookie 限制非常重要，以免出现不可预期的后果。

  浏览器中对于 cookie 的尺寸也有限制。大多数浏览器都有大约 4096B (加减1) 的长度限制。为了最佳的浏览器兼容性，最好将整个 cookie
长度限制在 4095 (含4095) 以内。尺寸限制影响到一个域下所有的 cookie ，而并非每个 cookie 单独限制。

  如果你尝试创建超过最大尺寸限制的 cookie ，那么该 cookie 会被悄无声息地丢掉。注意，虽然一个字符通常占用一字节，但是多字节情况
则有所不同。

#### 2 cookie 的构成

  cookie 由浏览器保存的以下几块信息构成。
  - 名称：一个唯一确定 cookie 的名称。cookie 名称是不区分大小写的，所以 myCookie 和 MyCookie 被认为是同一个 cookie 。然而，
  实践中最好将 cookie 名称看作是区分大小写的，因为某些服务器会这样处理 cookie 。cookie 的名称必须是经过 URL 编码的。

  - 值： 存储在 cookie 中的字符串值。值必须被 URL 编码。

  - 域： cookie 对于哪个域是有效的。所有向该域发送的请求中都包含这个 cookie 信息。这个值可以包含子域
  (subdomain，如 www.wrox.com)，也可以不包含它 (如 .wrox.com，则对于 wrox.com 的所有子域都有效)。如果没有明确设定，
  那么这个域回被认作来自设置 cookie 的那个域。

  - 路径： 对于指定域中的那个路径，应该向服务器发送 cookie 。例如，你可以指定 cookie 只有从 http://www.wrox.com/books/ 中
  才能访问，那么 http://www.wrox.com 的页面就不会发送 cookie 信息，即使请求都是来自同一个域的。

  - 失效时间： 表示 cookie 何时应该被删除的时间戳 (也就是，何时应该停止向服务器发送这个 cookie) 。默认情况下，浏览器会话结束
  时即将所有 cookie 删除；不过也可以自己设置删除时间。这个值是个 GMT 格式的日期 (Wdy, DD-Mon-YYYY HH:MMSSS GMT)，
  用于指定应该删除 cookie 的准确时间。因此，cookie 可在浏览器关闭后依然保存在用户的机器上。如果你设置的失效日期是个
  以前的时间，则 cookie 会被立刻删除。

  - 安全标志： 指定后，cookie 只有在使用 SSL 连接的时候才发送到服务器。例如，cookie 信息只能发送给 https://www.wrox.com ，
  而 http://www.wrox.com 的请求则不能发送 cookie 。

  每一段信息都作为 Set-Cookie 头的一部分，使用分号加空格分隔每一段，如下例所示。

    HTTP/1.1 200 OK
    Content-type: text/html
    Set-Cookie: name=value; expires=Mon, 22-Jan-07 07:10:24 GMT; domain=.wrox.com
    Other-header: other-header-value

  该头信息指定了一个叫做 name 的 cookie ，它回在格林威治时间 2007年1月22日 7：10：24 失效，同时对于 www.wrox.com 和 wrox.com
的任何子域 (如 p2p.wrox.com) 都有效。

  secure 标志是 cookie 中唯一一个非名值对儿的部分，直接包含一个 secure 单词。如下：

    HTTP/1.1 200 OK
    Content-type: text/html
    Set-Cookie: name-value; domain=.wrox.com; path=/; secure
    Other-header: other-header-value

  这里，创建了一个对于所有 wrox.com 的子域和域名下 (由 path 参数指定的) 所有页面都有效的 cookie 。因为设置了 secure 标志，
这个 cookie 只能通过 SSL 连接才能传输。

  尤其要注意，域、路径、失效时间和 secure 标志都是服务器给浏览器的指示，以指定何时应该发送 cookie 。这些参数并不会作为发送到
服务器的 cookie 信息的一部分，只有名值对儿才会被发送。

#### 3 JavaScript 中的 cookie

  在 JavaScript 中处理 cookie 有些复杂，因为其众所周知的蹩脚的接口，即 BOM 的 document.cookie 属性。这个属性的独特之处
在于它会因为使用它的方式不同而表现出不同的行为。当用来获取属性值时，document.cookie 返回当前页面可用的
(根据 cookie 的域、路径、失效时间和安全设置) 所有 cookie 的字符串，一系列由分号隔开的名值对儿，如下例所示。